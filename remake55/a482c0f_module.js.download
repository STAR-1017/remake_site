(window._ambjs=window._ambjs||[]).push([[27],{ShxF:function(e,r,t){"use strict";t.d(r,"a",(function(){return a})),t.d(r,"b",(function(){return n})),t.d(r,"d",(function(){return o})),t.d(r,"c",(function(){return i})),t.d(r,"e",(function(){return l})),t.d(r,"f",(function(){return d})),t.d(r,"g",(function(){return u})),t.d(r,"h",(function(){return c})),t.d(r,"i",(function(){return f})),t.d(r,"j",(function(){return p}));var a="pc_entry_lower",n="pc_old_skin_nav_bar",o="pc_sidebar_profile",i="pc_sidebar_follower",l="sp_blogheader",d="sp_blogheader_recommendation",u="sp_drawer",c="sp_entry_lower",f="sp_entry_upper",p="sp_followfeed_recommend_drawer"},lhY6:function(e,r,t){"use strict";t.d(r,"d",(function(){return P})),t.d(r,"a",(function(){return x})),t.d(r,"b",(function(){return Y})),t.d(r,"h",(function(){return H})),t.d(r,"c",(function(){return C})),t.d(r,"g",(function(){return G})),t.d(r,"e",(function(){return q})),t.d(r,"f",(function(){return J}));var a=t("eijD"),n=t("wTO3"),o=t("edSL"),i=t.n(o),l=t("YFs1"),d=t.n(l),u=t("XQLF"),c=t.n(u),f=t("PqlX"),p=t.n(f),b=t("3vJe"),y=t.n(b),s=t("o0Zv"),m=t("/HKI"),g=t("tDZY"),w=t("P6ex"),v=t("ARnF"),h=t("othg"),j=t("g8Ka"),O=t("eLU4"),A=t("gLD0"),I=t("oi/j"),T=t("xoe0"),S=t("ShxF"),_=t("x9GJ"),E=t("jga8"),L=(e,r)=>({type:E.j,payload:{targetAmebaId:e,isFollowing:r}}),P=Object(n.b)({ttl:300},e=>function(){var r=Object(a.a)((function*(r,t){if(!e)return null;if(void 0!==i()(t(),["followState","followMap",e,"isFollowing"]))return null;try{if(r({type:E.i,payload:{targetAmebaId:e}}),i()(t(),["followFeedState","feedMap","feed"],[]).some(r=>r.amebaId===e))return r(L(e,!0));if(yield r(Object(h.b)()),Object(_.a)(t())){if(i()(t(),["userState","sessionUser","amebaId"],"")===e)return r(L(e,!1));var a=t().amebloTokenState.amebloToken,n=yield m.c.getMemberFollowing(a,e);if(n.error)throw new Error(n.error);var o=!!i()(n,["data","relation","ameba_id"],"");return r(L(e,o))}yield r(Object(w.c)(j.g.INIT));var l=i()(t(),["followFeedState","feedMap","feed"],[]).some(r=>r.amebaId===e);return r(L(e,l))}catch(d){return r(((e,r)=>({type:E.h,payload:{targetAmebaId:e,error:r},error:!0}))(e,d))}}));return function(e,t){return r.apply(this,arguments)}}()),D=Object(n.b)({ttl:300},e=>function(){var r=Object(a.a)((function*(r,t){if(yield r(Object(h.b)()),!Object(_.a)(t()))return null;var{force:a=!1}=e||{},n=t().followState.followActionMap.limit||{};if(!a&&c()(n.remainingTotal)&&c()(n.remainingPerDay))return null;try{r({type:E.l});var o=t().amebloTokenState.amebloToken,i=yield m.c.fetchRemainingFollow(o);if(i.error)throw new Error(i.error);var l,{remaining:d,remaining_per_day:u}=i.data||{};return u<=0?l=j.e.DAILY:d<=0&&(l=j.e.TOTAL),r(((e,r,t,a)=>({type:E.m,payload:{isUpperLimit:e,limitType:r,remainingTotal:t,remainingPerDay:a}}))(!!l,l,d,u))}catch(f){return r((e=>({type:E.k,payload:{error:e},error:!0}))(f))}}));return function(e,t){return r.apply(this,arguments)}}()),F=(e,r,t)=>({type:E.p,payload:{targetAmebaId:e,recommendedAmebaIds:r,sessionAmebaId:t}}),M=(e,r)=>({type:E.o,payload:{targetAmebaId:e,error:r},error:!0}),k=Object(n.b)({ttl:500},(function(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return function(){var n=Object(a.a)((function*(a,n,o){var{fetchr:i}=o,l=n().followState.followSuggestMap[e]||{};if(l.isLoading||p()(l.suggestedAmebaIds))return null;a({type:E.n,payload:{targetAmebaId:e}});try{var d=((yield i.read(O.a.RecommendBloggerToBlogger).params({amebaId:e,resultType:r?"official":"general",serviceCode:"blog_afterfollow_sp",length:"".concat(t)}).end().catch(e=>{throw"undefined"!=typeof window&&window.handleErrorBySentry&&window.handleErrorBySentry(e),e})).data||[]).map(e=>e.ameba_id);yield Promise.all([a(Object(h.a)()),...d.map(e=>a(P(e)))]);var u=n().userState.sessionUser.amebaId||"";return a(F(e,d,u))}catch(c){return a(M(e,c))}}));return function(e,r,t){return n.apply(this,arguments)}}()})),U=()=>({type:E.q}),B=(e,r,t,a,n,o)=>({type:E.c,payload:{targetAmebaId:e,isUpperLimit:r,limitType:a,remainingTotal:n,remainingPerDay:o,isSetLatesetFollowedAmebaId:t}}),x=Object(n.b)({ttl:300},(e,r,t)=>function(){var n=Object(a.a)((function*(a,n){try{if(a({type:E.b,payload:{targetAmebaId:e,actionRoute:r}}),!e)throw new Error("targetAmebaId is invalid");if(r===S.e){yield a(Object(g.b)(e));var o=i()(n().bloggerState.bloggerMap,[e,"attribute","isOfficial"])||!1;a(k(e,o))}yield a(Object(h.b)());var l=Object(_.a)(n()),d=r===S.j;if(l){yield a(D());var{isUpperLimit:u,limitType:f}=n().followState.followActionMap;if(u){if(a(U()),f===j.e.DAILY)return a(Object(v.a)(A.d));if(f===j.e.TOTAL)return a(Object(v.a)(A.e))}var{followType:p,isBrowserPushNotificationEnabled:b,isMailNotificationEnabled:O}=t||{};if(p!==j.d.APPLICANTS&&p!==j.d.WATCHER)return a(U()),a(Object(v.a)(A.c));var T=n().amebloTokenState.amebloToken,L=yield m.c.follow(T,e,p,b,O,r);if(L.error)throw new Error(L.error);if(!L.data)throw new Error(L.data);var P,F=n().followState.followActionMap.limit||{},M=c()(F.remainingTotal)?F.remainingTotal-1:void 0,x=c()(F.remainingPerDay)?F.remainingPerDay-1:void 0;x<=0?P=j.e.DAILY:M<=0&&(P=j.e.TOTAL);var R=!!P;yield a(B(e,R,d,P,M,x))}else{var Y=i()(y.a.parse(document.cookie),"P",null),H=yield s.a.postGuestStorage(Y,e,Object(I.a)(),r);if(!H.ok)throw new Error(yield H.text());var N=yield H.json(),C=(N?N.amebaIds:[]).length===j.f;yield a(B(e,C,d))}return a(Object(w.c)(j.g.UPDATE))}catch(G){return a((e=>({type:E.a,payload:{error:e},error:!0}))(G))}}));return function(e,r){return n.apply(this,arguments)}}()),R=(e,r,t)=>({type:E.f,payload:{targetAmebaId:e,remainingTotal:r,remainingPerDay:t}}),Y=Object(n.b)({ttl:300},(e,r,t)=>function(){var n=Object(a.a)((function*(a,n){try{if(a({type:E.e,payload:{targetAmebaId:e,actionRoute:r}}),!e)throw new Error("targetAmebaId is invalid");yield a(Object(h.b)());var o=Object(_.a)(n()),{confirmed:l}=t||{};if(!l)return a(U()),a(Object(v.a)(A.f));if(o){var d=n().amebloTokenState.amebloToken,u=yield m.c.unfollow(d,e);if(u.error)throw new Error(u.error);if(!u.data)throw new Error(u.data);var f=n().followState.followActionMap.limit||{},p=c()(f.remainingTotal)?f.remainingTotal+1:void 0,b=c()(f.remainingPerDay)?f.remainingPerDay+1:void 0;yield a(R(e,p,b))}else{var g=i()(y.a.parse(document.cookie),"P",null),O=yield s.a.deleteGuestStorage(g,e,Object(I.a)(),r);if(!O.ok)throw new Error(yield O.text());yield a(R(e))}return a(Object(w.c)(j.g.UPDATE))}catch(T){return a((e=>({type:E.d,payload:{error:e},error:!0}))(T))}}));return function(e,r){return n.apply(this,arguments)}}()),H=Object(n.b)({ttl:300},e=>function(){var r=Object(a.a)((function*(r){return e?r({type:E.u,payload:{targetAmebaId:e}}):null}));return function(e){return r.apply(this,arguments)}}()),N=e=>({type:E.g,payload:{shouldDisplayFirstFollowing:e}}),C=Object(n.b)({ttl:200},e=>function(){var r=Object(a.a)((function*(r,t){if(!e)return null;var a={subscriptionButton:!1,profileInfo:!1},n=Object(_.a)(t()),o=i()(t(),["followState","followMap",e,"isFollowing"],!1);if(n||o)return r(N(a));if(i()(t(),["followState","followActionMap","isUpperLimit"],!1))return r(N(a));var l=i()(t(),["historyState","browsingHistoryMap","browsingHistoryList"],[]);if(d()(l))return r(N(a));var u=l.filter(r=>r.amebaId===e&&r.pageType===T.a.Entry).length,c=i()(t(),["followState","followActionMap","hasFollowedUp"],!1),f={subscriptionButton:c?[]:[2],profileInfo:c?[2]:[1,3]},p={subscriptionButton:f.subscriptionButton.includes(u),profileInfo:f.profileInfo.includes(u)};return r(N(p))}));return function(e,t){return r.apply(this,arguments)}}()),G=()=>({type:E.t}),q=()=>({type:E.s}),J=()=>({type:E.r})}}]);